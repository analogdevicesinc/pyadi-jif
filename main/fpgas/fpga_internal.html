<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FPGA Clocking &#8212; pyadi-jif v0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8e8a900e" />
    <link rel="stylesheet" type="text/css" href="../_static/app.min.css?v=c218d0f6" />
    <link rel="stylesheet" type="text/css" href="../_static/css/style.css?v=632a43e7" />
    <script defer="" src="../_static/app.umd.js?v=fe5054b0"></script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Supported Parts" href="../parts.html" />
    <link rel="prev" title="FPGA Configuration" href="fpgas.html" />
   
  
  <meta name="repository" content="pyadi-jif">
  <meta name="version" content="">
  
    <meta name="page_source_suffix" content=".md">
  
  


<style>
  body {
    
  }

  body.dark {
    
  }

  @media (prefers-color-scheme: dark) {
    body:not(.light) {
      
    }
  }
</style>
  </head><body>
  <input type="checkbox" id="input-show-toc">
  <input type="checkbox" id="input-show-localtoc">
  <input type="checkbox" id="input-show-repotoc">

  
  <div class="search-area">
    <form action="" method="get">
      <input type="text" name="q" aria-labelledby="search-documentation" value="" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="search" placeholder="Search"/>
      <button class="icon"></button>
    </form>
  </div>
  

  <header>
    <div id="left">
      <label id="show-sidebar" class="icon" for="input-show-toc" title="Show/hide index"></label>
    </div>
    <div id="right">
      <span>
        <a id="logo-org" href="https://analog.com"></a>
        <div class="vertical-divider"></div>
        <label id="show-repotoc" for="input-show-repotoc" title="Show/hide docs" tabindex="0">Docs</label>
        <a id="logo" href="../index.html">
          <div>pyadi-jif</div>
        </a>
      </span>
      <span class="reverse">
        <label id="show-localtoc" class="icon" for="input-show-localtoc" title="Show/hide contents"></label>
      </span>
    </div>
  </header>


  <div class="repotoc-tree overlay">
    <root>
  <a href="../index.html" class="current">pyadi-jif</a>
</root>

  </div>
    <div class="localtoc">
      <div class="tocwrapper">
        <div>
          <div class="localtoc-header"></div>
          <a id="scroll-up" href="#top-anchor" title="Back to top"></a>
        </div>
        <nav>
          <ul>
<li><a class="reference internal" href="#">FPGA Clocking</a><ul>
<li><a class="reference internal" href="#clocking-layout">Clocking Layout</a><ul>
<li><a class="reference internal" href="#search-strategy">Search Strategy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-controls">API Controls</a><ul>
<li><a class="reference internal" href="#per-part-configuration">Per Part Configuration</a></li>
<li><a class="reference internal" href="#separate-sysref-sources">Separate SYSREF Sources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-clock-source">Device Clock Source</a></li>
</ul>
</li>
</ul>

        </nav>
      </div>
    </div>

  
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
    <a id="logo" href="../index.html">
      <img class="only-light" src="../_static/imgs/PyADI-JIF_logo_cropped.png"/>
      <img class="only-dark" src="../_static/imgs/PyADI-PyADI-JIF_logo_w_cropped.png"/>
    </a><input id="input-switch-toc" type="checkbox">
<label id="show-repotoc" for="input-switch-toc">
All content
</label>
<label id="show-toc" for="input-switch-toc">
Content on this topic
</label>
<div class="repotoc-tree">
  <root>
  <a href="../index.html" class="current">pyadi-jif</a>
</root>

</div>
<div class="toc-tree">
  <html>
  <body><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing PyADI-JIF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow.html">Usage Flows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../converters.html">Data converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clocks.html">Clock chips</a></li>
<li class="toctree-l1 current"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1" id="toctree-collapse-1" checked=""/><div class="collapse"><a class="reference internal" href="index.html">FPGAs</a><label for="toctree-collapse-1"><div class="icon"></div></label></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fpgas.html">FPGA Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">FPGA Clocking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../parts.html">Supported Parts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../defs.html">JESD204 Definitions</a></li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-2" id="toctree-collapse-2"/><div class="collapse"><a class="reference internal" href="../devs/index.html">Reference APIs</a><label for="toctree-collapse-2"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../devs/converters.html">Converter Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devs/clocks.html">Clock Chip Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devs/plls.html">PLLs Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devs/fpga_ref.html">FPGA Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devs/jesd.html">JESD204 Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../draw.html">Drawings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">Developer documentation</a></li>
</ul>
</body>
</html>

</div>
        </div>
      </div>

  <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper" id="top-anchor">
          <div class="body-header">
    <nav class="breadcrumb">
        <ol>
          <li><a href="index.html">FPGAs</a></li>
          </ol>
    </nav>
  </div>

          <div class="body" role="main">
            
  <section id="fpga-clocking">
<h1>FPGA Clocking<a class="headerlink" href="#fpga-clocking" title="Link to this heading"></a></h1>
<p>JESD204 is a protocol that is made up of layers to manage the different aspects of the data link between the converters and FPGA. On the converter side this is handled for you by the ASIC designer but the FPGA side requires a lot more work. This is heavily managed by the <a class="reference external" href="https://wiki.analog.com/resources/fpga/peripherals/jesd204">ADI JESD204 Framework</a>, but it still needs to be specifically configured and laid out correctly for a specific use case or set of use cases.</p>
<p><img alt="JESD204 Chain" src="../_images/jesd204_chain.png" /></p>
<p>From the diagram above, we can see in the FPGA there are explicit cores within the FPGA to manager the PHY Layer, Link Layer, and Transport Layer aspects for the JESD204 protocol. These will have specific drivers and HDL IP that need to configured for a configuration. By configuration, it primarily refers to the clocking and JESD modes. In the diagram there are both TX and RX data paths but generically they can be considered identical, data will just flow in a specific direction in each case.</p>
<section id="clocking-layout">
<h2>Clocking Layout<a class="headerlink" href="#clocking-layout" title="Link to this heading"></a></h2>
<p>Focusing on an individual chain, we can consider the diagram below where the individual clocks are detailed. These clocks can be provided externally or internally but must meet some basic requirements. Traditionally they will come from an external clocking devices, which can drastically save power and resources, and <strong>adijif</strong> takes this approach.</p>
<p><img alt="gearbox" src="../_images/gearbox.png" /></p>
<p>The clocks will have the following constraints:</p>
<ul class="simple">
<li><p><strong>ref clock</strong>: This clock’s primary purpose is to drive the SERDES which will typically happen by feeding the CPLL or QPLL inside the transceiver primitives of the FPGA. Therefore, it’s frequency is determined base on the PLL dividers and range limitations. The constraint here is that the <strong>ref clock</strong> times the PLL multiply/divide ratio must meet the lane rate of the desired link, which is fixed.</p></li>
<li><p><strong>link clock</strong>: This clock must be <em>lane rate /40</em> (204B) or <em>lane rate /66</em> (204C). It most cases the <strong>ref clock</strong> and the <strong>link clock</strong> will be the same value, or the <strong>ref clock</strong> is just selected to be equal to the <strong>link clock</strong> from the start for simplicity. However, this is not always possible. Therefore, the FPGA PLL clock dividers and muxes can be used to correctly meet this requirement from an upstream clock. These dividers and muxed are detailed in the diagram below, where <em>RXOUTCLK</em> is itself used to drive the link layer.</p></li>
<li><p><strong>device clock</strong>: This clock is unique since it must be derived from the same source as <strong>SYSREF</strong>, since it is used to sample <strong>SYSREF</strong> and be a multiple of the sample clock. The <strong>device clock</strong> determines the output rate of the link layer, and when this rate is different than the <strong>link clock</strong> it will enable the <strong>Gearbox</strong> inside the link layer HDL core. This will occur usually when <em>N’</em> is not 8 or 16, or when <em>F</em> != 1, 2, or 4. It is also important to select this clock with respect to desired data rate constraints for downstream logic since this is the rate application logic must consume data at. This clock will be at the <em>sample clock / SPC</em> where SPC is some integer. However, this rate should not exceed the Fmax of the FPGA logic. SPC is specific to the JESD204 mode and is calculated like so:</p>
<ul>
<li><p>JESD204B: <em>SPC = (32 * L) / (M * N’)</em></p></li>
<li><p>JESD204C: <em>SPC = (64 * L) / (M * N’)</em></p></li>
</ul>
</li>
<li><p><strong>SYSREF</strong>: This clock is simple the system reference and will be <em>lane rate / M</em> where M is a power of 2 and should be large.</p></li>
</ul>
<p>Technically, only the <strong>device clock</strong> is needed by the FPGA and all other clocks (except for <strong>SYSREF</strong>) could be derived from it. This assumes the necessary ratios are possible by the internal dividers. However, in most cases <strong>SYSREF</strong> is used for deterministic latency.</p>
<figure class="align-default" id="id1">
<img alt="../_images/xilinx_pll_mux.png" src="../_images/xilinx_pll_mux.png" />
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://docs.xilinx.com/v/u/en-US/ug576-ultrascale-gth-transceivers">From Xilinx UG576</a></span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<section id="search-strategy">
<h3>Search Strategy<a class="headerlink" href="#search-strategy" title="Link to this heading"></a></h3>
<p>There are two main unique cases when selecting the <strong>ref clock</strong> and <strong>device clock</strong>:</p>
<ul class="simple">
<li><p><em>N’</em> is not 8 or 16, or when <em>F</em> != 1, 2, or 4</p></li>
<li><p>Otherwise</p></li>
</ul>
<p>In case (1) the <strong>ref clock</strong> is unlikely to be derived from the <strong>device clock</strong>. Therefore, two separate clocks need to be provided to the FPGA. Otherwise, only a single clock (ignoring <strong>SYSREF</strong>) is required. This is the general behavior based on current analysis; however, this is not a hard definition. The internal solver is configured to favor <strong>ref clock</strong> and <strong>device clock</strong> to be the same value. When this is not possible it will automatically create a secondary clock from the clock chip to be specifically used as the <strong>device clock</strong>. The generation of a separate clock for device clock can be forced by setting <em>force_separate_device_clock</em> in the <em>fpga</em> object instantiated in the <em>system</em> object.</p>
</section>
</section>
<section id="api-controls">
<h2>API Controls<a class="headerlink" href="#api-controls" title="Link to this heading"></a></h2>
<p>To manage the generation of these clocks, APIs are provided in the FPGA specific classes (<em>adijif.fpga.xilinx</em>). These are:</p>
<ul class="simple">
<li><p><strong>out_clk_select</strong>: Control {RX/TX}CLKSEL mux. Options are <em>XCVR_REFCLK</em>, <em>XCVR_REFCLK_DIV2</em>, <em>XCVR_PROGDIV_CLK</em></p></li>
<li><p><strong>force_cpll</strong>: Force use of CPLL</p></li>
<li><p><strong>force_qpll</strong>: Force use of QPLL</p></li>
<li><p><strong>force_qpll1</strong>: Force use of QPLL1 (only available on GTH and GTY transceivers)</p></li>
<li><p><strong>device_clock_source</strong>: Control the source of the <strong>device clock</strong>. This would be:</p>
<ul>
<li><p><em>external</em>: Get clock from external clock chip</p></li>
<li><p><em>link_clock</em>: Use <strong>link clock</strong> which is derived from the <strong>PHY</strong> layer</p></li>
<li><p><em>ref_clock</em>: Use <strong>ref clock</strong> which drives the <strong>PHY</strong> layer</p></li>
</ul>
</li>
</ul>
<p>By default <strong>adijif</strong> will try to determine valid PLL settings and necessary muxing settings to meet the <strong>link clock</strong> and <strong>ref clock</strong> requirements. The <strong>device clock source</strong> can also be automatically be determined by the solver.</p>
<p>Below is an example of an explicit request for a separate <strong>device clock</strong> and since <strong>out_clk_select</strong> is set to <em>XCVR_REFCLK</em> it will force the <strong>ref clock</strong> to be equal to the <strong>link clock</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">adijif</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pprint</span>

<span class="n">vcxo</span> <span class="o">=</span> <span class="mf">125e6</span>

<span class="n">sys</span> <span class="o">=</span> <span class="n">adijif</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;ad9680&quot;</span><span class="p">,</span> <span class="s2">&quot;ad9523_1&quot;</span><span class="p">,</span> <span class="s2">&quot;xilinx&quot;</span><span class="p">,</span> <span class="n">vcxo</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">Debug_Solver</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">setup_by_dev_kit_name</span><span class="p">(</span><span class="s2">&quot;zcu102&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">force_cpll</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">out_clk_select</span> <span class="o">=</span> <span class="s2">&quot;XCVR_REFCLK&quot;</span>  <span class="c1"># force reference to be core clock rate</span>

<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">use_direct_clocking</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">set_quick_configuration_mode</span><span class="p">(</span><span class="mh">0x88</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">S</span> <span class="o">==</span> <span class="mi">1</span>

<span class="c1"># Limit upper dividers to powers of 2</span>
<span class="n">sys</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>

<span class="c1"># Current configuration</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">sample_clock</span> <span class="o">=</span> <span class="mf">1e9</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">System output</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;clock&#39;: {&#39;m1&#39;: 3,
           &#39;n2&#39;: 24,
           &#39;out_dividers&#39;: [2, 64, 8, 8],
           &#39;output_clocks&#39;: {&#39;AD9680_ref_clk&#39;: {&#39;divider&#39;: 2,
                                                &#39;rate&#39;: 500000000.0},
                             &#39;AD9680_sysref&#39;: {&#39;divider&#39;: 64,
                                               &#39;rate&#39;: 15625000.0},
                             &#39;zcu102_AD9680_device_clk&#39;: {&#39;divider&#39;: 8,
                                                          &#39;rate&#39;: 125000000.0},
                             &#39;zcu102_AD9680_ref_clk&#39;: {&#39;divider&#39;: 8,
                                                       &#39;rate&#39;: 125000000.0}},
           &#39;part&#39;: &#39;AD9523-1&#39;,
           &#39;r2&#39;: 1,
           &#39;vco&#39;: 1000000000.0,
           &#39;vcxo&#39;: 125000000.0},
 &#39;converter&#39;: [],
 &#39;converter_AD9680&#39;: {&#39;clocking_option&#39;: &#39;direct&#39;, &#39;decimation&#39;: 1},
 &#39;fpga_AD9680&#39;: {&#39;d&#39;: 1,
                 &#39;device_clock_source&#39;: &#39;external&#39;,
                 &#39;m&#39;: 1,
                 &#39;n1&#39;: 4,
                 &#39;n2&#39;: 5,
                 &#39;out_clk_select&#39;: &#39;XCVR_REFCLK&#39;,
                 &#39;sys_clk_select&#39;: &#39;XCVR_CPLL&#39;,
                 &#39;transport_samples_per_clock&#39;: 4.0,
                 &#39;type&#39;: &#39;cpll&#39;,
                 &#39;vco&#39;: 2500000000.0},
 &#39;jesd_AD9680&#39;: {&#39;CS&#39;: 0,
                 &#39;F&#39;: 1,
                 &#39;HD&#39;: 1,
                 &#39;K&#39;: 32,
                 &#39;L&#39;: 4,
                 &#39;M&#39;: 2,
                 &#39;Np&#39;: 16,
                 &#39;S&#39;: 1,
                 &#39;bit_clock&#39;: 5000000000.0,
                 &#39;converter_clock&#39;: 500000000.0,
                 &#39;jesd_class&#39;: &#39;jesd204b&#39;,
                 &#39;jesd_mode&#39;: &#39;136&#39;,
                 &#39;multiframe_clock&#39;: 15625000.0,
                 &#39;sample_clock&#39;: 500000000.0}}
</pre></div>
</div>
</div>
<p>In the output the lines specific to the link layer and mux configuration have are noteed by fields <strong>out_clk_select</strong> and <strong>sys_clk_select</strong>.</p>
<section id="per-part-configuration">
<h3>Per Part Configuration<a class="headerlink" href="#per-part-configuration" title="Link to this heading"></a></h3>
<p>By default individual FPGA properties will be applies to all signal chains. However, if a specific only wants to be applied to the ADC or DAC side, or ADC1 but not ADC2, this configuration is possible. This is done through dictionary parameterization as following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span> <span class="o">=</span> <span class="n">adijif</span><span class="o">.</span><span class="n">system</span><span class="p">([</span><span class="s2">&quot;ad9680&quot;</span><span class="p">,</span> <span class="s2">&quot;ad9144&quot;</span><span class="p">],</span> <span class="s2">&quot;ad9523_1&quot;</span><span class="p">,</span> <span class="s2">&quot;xilinx&quot;</span><span class="p">,</span> <span class="mf">125e6</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">setup_by_dev_kit_name</span><span class="p">(</span><span class="s2">&quot;zcu102&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">force_cpll</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">out_clk_select</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s2">&quot;XCVR_REFCLK&quot;</span><span class="p">,</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;XCVR_REFCLK_DIV2&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">requires_separate_link_layer_out_clock</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="separate-sysref-sources">
<h3>Separate SYSREF Sources<a class="headerlink" href="#separate-sysref-sources" title="Link to this heading"></a></h3>
<p>With the introduction of ADF4030, it is possible to split the source of <strong>SYSREF</strong> and <strong>ref clock</strong>. Internally this is a similar concept to external PLL usage for converter clock references that directly drive the converter. The <strong>SYSREF</strong> source can be modified by using the <em>add_pll_sysref</em> method on the system object. This will automatically add the <strong>SYSREF</strong> source to the converter and connected FPGA models. This method supports both converters and nested converter (like AD9081) models. After a solution is found the output configuration will have a new field that references the new <strong>SYSREF</strong> source. An example of this is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pprint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">adijif</span>

<span class="n">vcxo</span> <span class="o">=</span> <span class="mf">100e6</span>
<span class="n">cddc</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">fddc</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">sys</span> <span class="o">=</span> <span class="n">adijif</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;ad9081&quot;</span><span class="p">,</span> <span class="s2">&quot;hmc7044&quot;</span><span class="p">,</span> <span class="s2">&quot;xilinx&quot;</span><span class="p">,</span> <span class="n">vcxo</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;CPLEX&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">setup_by_dev_kit_name</span><span class="p">(</span><span class="s2">&quot;zcu102&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">ref_clock_constraint</span> <span class="o">=</span> <span class="s2">&quot;Unconstrained&quot;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">sys_clk_select</span> <span class="o">=</span> <span class="s2">&quot;XCVR_QPLL0&quot;</span>  <span class="c1"># Use faster QPLL</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">out_clk_select</span> <span class="o">=</span> <span class="s2">&quot;XCVR_PROGDIV_CLK&quot;</span>  <span class="c1"># force reference to be core clock rate</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">adc</span><span class="o">.</span><span class="n">sample_clock</span> <span class="o">=</span> <span class="mi">2900000000</span> <span class="o">/</span> <span class="p">(</span><span class="n">cddc</span> <span class="o">*</span> <span class="n">fddc</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">dac</span><span class="o">.</span><span class="n">sample_clock</span> <span class="o">=</span> <span class="mi">5800000000</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">adc</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">cddc_decimations</span> <span class="o">=</span> <span class="p">[</span><span class="n">cddc</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">adc</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">fddc_decimations</span> <span class="o">=</span> <span class="p">[</span><span class="n">fddc</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">adc</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">fddc_enabled</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">dac</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">cduc_interpolation</span> <span class="o">=</span> <span class="n">cddc</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">dac</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">fduc_interpolation</span> <span class="o">=</span> <span class="n">fddc</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">dac</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">fduc_enabled</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
<span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">dac</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">==</span> <span class="n">cddc</span> <span class="o">*</span> <span class="n">fddc</span>

<span class="c1"># Add ADF4030 as SYSREF source for ADC and DAC</span>
<span class="n">sys</span><span class="o">.</span><span class="n">add_pll_sysref</span><span class="p">(</span><span class="s2">&quot;adf4030&quot;</span><span class="p">,</span> <span class="n">vcxo</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="p">)</span>

<span class="n">mode_tx</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
<span class="n">mode_rx</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">dac</span><span class="o">.</span><span class="n">set_quick_configuration_mode</span><span class="p">(</span><span class="n">mode_tx</span><span class="p">,</span> <span class="s2">&quot;jesd204c&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">adc</span><span class="o">.</span><span class="n">set_quick_configuration_mode</span><span class="p">(</span><span class="n">mode_rx</span><span class="p">,</span> <span class="s2">&quot;jesd204c&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">adc</span><span class="o">.</span><span class="n">bit_clock</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">dac</span><span class="o">.</span><span class="n">bit_clock</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">dac</span><span class="o">.</span><span class="n">converter_clock</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">ADF4030 output</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sys.converter.adc.bit_clock=11962500000.0
sys.converter.dac.bit_clock=11962500000.0
Continued
Continued
{&#39;clock&#39;: {&#39;n2&#39;: 29,
           &#39;out_dividers&#39;: [5, 8, 16, 8, 16],
           &#39;output_clocks&#39;: {&#39;AD9081_ref_clk&#39;: {&#39;divider&#39;: 5,
                                                &#39;rate&#39;: 580000000.0},
                             &#39;zcu102_adc_device_clk&#39;: {&#39;divider&#39;: 16,
                                                       &#39;rate&#39;: 181250000.0},
                             &#39;zcu102_adc_ref_clk&#39;: {&#39;divider&#39;: 8,
                                                    &#39;rate&#39;: 362500000.0},
                             &#39;zcu102_dac_device_clk&#39;: {&#39;divider&#39;: 16,
                                                       &#39;rate&#39;: 181250000.0},
                             &#39;zcu102_dac_ref_clk&#39;: {&#39;divider&#39;: 8,
                                                    &#39;rate&#39;: 362500000.0}},
           &#39;r2&#39;: 1,
           &#39;vco&#39;: 2900000000.0,
           &#39;vcxo&#39;: 100000000.0,
           &#39;vcxo_doubler&#39;: 1},
 &#39;clock_ext_pll_sysref_adf4030&#39;: {&#39;n&#39;: 145,
                                  &#39;out_dividers&#39;: [1280, 1280],
                                  &#39;output_clocks&#39;: {&#39;adc_sysref&#39;: {&#39;divider&#39;: 1280,
                                                                   &#39;rate&#39;: 1888020.8333333333},
                                                    &#39;dac_sysref&#39;: {&#39;divider&#39;: 1280,
                                                                   &#39;rate&#39;: 1888020.8333333333}},
                                  &#39;r&#39;: 6,
                                  &#39;vco&#39;: 2416666666.6666665},
 &#39;converter&#39;: {&#39;clocking_option&#39;: &#39;integrated_pll&#39;,
               &#39;pll_config&#39;: {&#39;d&#39;: 3,
                              &#39;m_vco&#39;: 5,
                              &#39;n_vco&#39;: 3,
                              &#39;r&#39;: 1,
                              &#39;serdes_pll_div&#39;: 1}},
 &#39;datapath_adc&#39;: {&#39;cddc&#39;: {&#39;decimations&#39;: [6, 6, 6, 6],
                           &#39;enabled&#39;: [True, True, True, True],
                           &#39;nco_frequencies&#39;: [0, 0, 0, 0],
                           &#39;nco_phases&#39;: [0, 0, 0, 0]},
                  &#39;fddc&#39;: {&#39;decimations&#39;: [4, 4, 4, 4, 4, 4, 4, 4],
                           &#39;enabled&#39;: [True,
                                       True,
                                       True,
                                       True,
                                       True,
                                       True,
                                       True,
                                       True],
                           &#39;nco_frequencies&#39;: [0, 0, 0, 0, 0, 0, 0, 0],
                           &#39;nco_phases&#39;: [0, 0, 0, 0, 0, 0, 0, 0],
                           &#39;source&#39;: [1, 1, 2, 2, 3, 3, 4, 4]}},
 &#39;datapath_dac&#39;: {&#39;cduc&#39;: {&#39;enabled&#39;: [True, True, True, True],
                           &#39;interpolation&#39;: 6,
                           &#39;nco_frequencies&#39;: [0, 0, 0, 0],
                           &#39;nco_phases&#39;: [0, 0, 0, 0],
                           &#39;sources&#39;: [[1], [1], [3], [3]]},
                  &#39;fduc&#39;: {&#39;enabled&#39;: [True,
                                       True,
                                       True,
                                       True,
                                       True,
                                       True,
                                       True,
                                       True],
                           &#39;interpolation&#39;: 4,
                           &#39;nco_frequencies&#39;: [0, 0, 0, 0, 0, 0, 0, 0],
                           &#39;nco_phases&#39;: [0, 0, 0, 0, 0, 0, 0, 0]}},
 &#39;fpga_adc&#39;: {&#39;clkout_rate&#39;: 1,
              &#39;d&#39;: 2,
              &#39;device_clock_source&#39;: &#39;external&#39;,
              &#39;m&#39;: 1,
              &#39;n&#39;: 33,
              &#39;n_dot_frac&#39;: 33,
              &#39;out_clk_select&#39;: &#39;XCVR_PROGDIV_CLK&#39;,
              &#39;progdiv&#39;: 66,
              &#39;sys_clk_select&#39;: &#39;XCVR_QPLL1&#39;,
              &#39;transport_samples_per_clock&#39;: 0.6666666666666666,
              &#39;type&#39;: &#39;qpll1&#39;,
              &#39;vco&#39;: 11962500000},
 &#39;fpga_dac&#39;: {&#39;clkout_rate&#39;: 1,
              &#39;d&#39;: 2,
              &#39;device_clock_source&#39;: &#39;external&#39;,
              &#39;m&#39;: 1,
              &#39;n&#39;: 33,
              &#39;n_dot_frac&#39;: 33,
              &#39;out_clk_select&#39;: &#39;XCVR_PROGDIV_CLK&#39;,
              &#39;progdiv&#39;: 66,
              &#39;sys_clk_select&#39;: &#39;XCVR_QPLL0&#39;,
              &#39;transport_samples_per_clock&#39;: 0.6666666666666666,
              &#39;type&#39;: &#39;qpll&#39;,
              &#39;vco&#39;: 11962500000},
 &#39;jesd_adc&#39;: {&#39;CS&#39;: 0,
              &#39;F&#39;: 12,
              &#39;HD&#39;: 0,
              &#39;K&#39;: 64,
              &#39;L&#39;: 1,
              &#39;M&#39;: 8,
              &#39;Np&#39;: 12,
              &#39;S&#39;: 1,
              &#39;bit_clock&#39;: 11962500000.0,
              &#39;converter_clock&#39;: 2900000000.0,
              &#39;jesd_class&#39;: &#39;jesd204c&#39;,
              &#39;jesd_mode&#39;: &#39;1.0&#39;,
              &#39;multiframe_clock&#39;: 1888020.8333333333,
              &#39;sample_clock&#39;: 120833333.33333333},
 &#39;jesd_dac&#39;: {&#39;CS&#39;: 0,
              &#39;F&#39;: 12,
              &#39;HD&#39;: 0,
              &#39;K&#39;: 64,
              &#39;L&#39;: 1,
              &#39;M&#39;: 8,
              &#39;Np&#39;: 12,
              &#39;S&#39;: 1,
              &#39;bit_clock&#39;: 11962500000.0,
              &#39;converter_clock&#39;: 2900000000.0,
              &#39;jesd_class&#39;: &#39;jesd204c&#39;,
              &#39;jesd_mode&#39;: &#39;0&#39;,
              &#39;multiframe_clock&#39;: 1888020.8333333333,
              &#39;sample_clock&#39;: 120833333.33333333}}

sys.converter.dac.converter_clock=2900000000.0
</pre></div>
</div>
</div>
</section>
</section>
<section id="device-clock-source">
<h2>Device Clock Source<a class="headerlink" href="#device-clock-source" title="Link to this heading"></a></h2>
<p>The main variation in the clock architecture is the source of the <strong>device clock</strong>. This can change due to availability of external clocks, subclass 1 requirements, and simplicity of the design. The <strong>device clock</strong> can be derived from the <strong>ref clock</strong>, <strong>link clock</strong>, or an external clock source. The default behavior is to use the <strong>external</strong> source as the <strong>device clock</strong> because it arguable provides the most flexibility and simplified in FPGA clock generation. However, this can be changed by setting the <em>device_clock_source</em> property in the FPGA object.</p>
<p>Topologically the different configurations look like this:</p>
<figure class="align-default" id="xilinx-example-external-device-clock">
<a class="reference internal image-reference" href="../_images/xilinx_example_external.svg"><img alt="../_images/xilinx_example_external.svg" src="../_images/xilinx_example_external.svg" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text">FPGA configuration with external device clock</span><a class="headerlink" href="#xilinx-example-external-device-clock" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="xilinx-example-link-device-clock">
<a class="reference internal image-reference" href="../_images/xilinx_example_link.svg"><img alt="../_images/xilinx_example_link.svg" src="../_images/xilinx_example_link.svg" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text">FPGA configuration with link clock sourced device clock</span><a class="headerlink" href="#xilinx-example-link-device-clock" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="xilinx-example-ref-device-clock">
<a class="reference internal image-reference" href="../_images/xilinx_example_ref.svg"><img alt="../_images/xilinx_example_ref.svg" src="../_images/xilinx_example_ref.svg" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text">FPGA configuration with reference clock sourced device clock</span><a class="headerlink" href="#xilinx-example-ref-device-clock" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


          </div>
              <div class="related">
                &nbsp;
    <a href="fpgas.html" title="Previous document (Alt+Shift+LeftArrow)" class="prev">FPGA Configuration</a>
    <a href="../parts.html" title="Next document (Alt+Shift+RightArrow)" class="next">Supported Parts</a>
              </div>
          
        </div>
      </div>
  </div>

  <label id="cancel-area-show-toc" for="input-show-toc"></label>
  <label id="cancel-area-show-localtoc" for="input-show-localtoc"></label>
    <footer>
      &#169;2020-2025, Analog Devices Inc.
      
      |
      Made with <a href="https://www.sphinx-doc.org/">Sphinx</a>
      &amp; <a href="https://github.com/analogdevicesinc/doctools">Doctools</a>
      
    </footer>
  </body>
</html>