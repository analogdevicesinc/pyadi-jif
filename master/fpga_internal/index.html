
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Python interface and configurator for the ADI JESD Interface Framework">
      
      
        <meta name="author" content="Analog Devices, Inc.">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.4, mkdocs-material-8.2.6">
    
    
      
        <title>Clocking - pyadi-jif</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.9d5733d3.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://fastapi.tiangolo.com/css/termynal.css">
    
      <link rel="stylesheet" href="https://fastapi.tiangolo.com/css/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fpga-clocking" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="pyadi-jif" class="md-header__button md-logo" aria-label="pyadi-jif" data-md-component="logo">
      
  <img src="../imgs/cpu.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pyadi-jif
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Clocking
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/analogdevicesinc/pyadi-jif/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="pyadi-jif" class="md-nav__button md-logo" aria-label="pyadi-jif" data-md-component="logo">
      
  <img src="../imgs/cpu.svg" alt="logo">

    </a>
    pyadi-jif
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/analogdevicesinc/pyadi-jif/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../flow/" class="md-nav__link">
        Usage Flow
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../converters/" class="md-nav__link">
        Data Converters
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../clocks/" class="md-nav__link">
        Clock Chips
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          FPGAs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="FPGAs" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          FPGAs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fpgas/" class="md-nav__link">
        Configuration Class
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Clocking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Clocking
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clocking-layout" class="md-nav__link">
    Clocking Layout
  </a>
  
    <nav class="md-nav" aria-label="Clocking Layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search-strategy" class="md-nav__link">
    Search Strategy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-controls" class="md-nav__link">
    API Controls
  </a>
  
    <nav class="md-nav" aria-label="API Controls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#per-part-configuration" class="md-nav__link">
    Per Part Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../parts/" class="md-nav__link">
        Supported Parts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../defs/" class="md-nav__link">
        Definitions
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../devs/converters/" class="md-nav__link">
        Data Converters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../devs/clocks/" class="md-nav__link">
        Clocks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../devs/jesd/" class="md-nav__link">
        JESD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fpga_ref/" class="md-nav__link">
        FPGAs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../developers/" class="md-nav__link">
        Developers
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clocking-layout" class="md-nav__link">
    Clocking Layout
  </a>
  
    <nav class="md-nav" aria-label="Clocking Layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search-strategy" class="md-nav__link">
    Search Strategy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-controls" class="md-nav__link">
    API Controls
  </a>
  
    <nav class="md-nav" aria-label="API Controls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#per-part-configuration" class="md-nav__link">
    Per Part Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/analogdevicesinc/pyadi-jif/edit/master/docs/fpga_internal.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="fpga-clocking">FPGA Clocking</h1>
<p>JESD204 is a protocol that is made up of layers to manage the different aspects of the data link between the converters and FPGA. On the converter side this is handled for you by the ASIC designer but the FPGA side requires a lot more work. This is heavily managed by the <a href="https://wiki.analog.com/resources/fpga/peripherals/jesd204">ADI JESD204 Framework</a>, but it still needs to be specifically configured and laid out correctly for a specific use case or set of use cases.</p>
<p><img alt="JESD204 Chain" src="../imgs/jesd204_chain.png" /></p>
<p>From the diagram above, we can see in the FPGA there are explicit cores within the FPGA to manager the PHY Layer, Link Layer, and Transport Layer aspects for the JESD204 protocol. These will have specific drivers and HDL IP that need to configured for a configuration. By configuration, it primarily refers to the clocking and JESD modes. In the diagram there are both TX and RX data paths but generically they can considered identical, data will just flow in a specific direction in each case.</p>
<h2 id="clocking-layout">Clocking Layout</h2>
<p>Focusing on an individual chain, we can consider the diagram below where the individual clocks are detailed. These clocks can be provided externally or internally but must meet some basic requirements. Traditionally they will come from an external clocking devices, which can drastically save power and resources, and <strong>adijif</strong> takes this approach.</p>
<p><img alt="gearbox" src="../imgs/gearbox.png" /></p>
<p>The clocks will have the following constraints:</p>
<ul>
<li><strong>ref clock</strong>: This clock's primary purpose is to drive the SERDES which will typically happen by feeding the CPLL or QPLL inside the transceiver primitives of the FPGA. Therefore, it's frequency is determined base on the PLL dividers and range limitations. The constraint here is that the <strong>ref clock</strong> times the PLL multiply/divide ratio must meet the lane rate of the desired link, which is fixed.</li>
<li><strong>link clock</strong>: This clock must be <em>lane rate /40</em> (204B) or <em>lane rate /66</em> (204C). It most cases the <strong>ref clock</strong> and the <strong>link clock</strong> will be the same value, or the <strong>ref clock</strong> is just selected to be equal to the <strong>link clock</strong> from the start for simplicity. However, this is not always possible. Therefore, the FPGA PLL clock dividers and muxes can be used to correctly meet this requirement from an upstream clock. These dividers and muxed are detailed in the diagram below, where <em>RXOUTCLK</em> is itself used to drive the link layer.</li>
<li><strong>device clock</strong>: This clock is unique since it must be derived from the same source as <strong>SYSREF</strong>, since it is used to sample <strong>SYSREF</strong> and be a multiple of the sample clock. The <strong>device clock</strong> determines the output rate of the link layer, and when this rate is different than the <strong>link clock</strong> it will enable the <strong>Gearbox</strong> inside the link layer HDL core. This will occur usually when <em>N'</em> is not 8 or 16, or when <em>F</em> != 1, 2, or 4. It is also important to select this clock with respect to desired data rate constraints for downstream logic since this is the rate application logic must consume data at. This clock will be at the <em>sample clock / N</em> where N is some integer. However, this rate should not exceed the Fmax of the FPGA logic.</li>
<li><strong>SYSREF</strong>: This clock is simple the system reference and will be <em>lane rate / M</em> where M is a power of 2 and should be large. </li>
</ul>
<p>Technically, only the <strong>device clock</strong> is needed by the FPGA and all other clocks (except for <strong>SYSREF</strong>) could be derived from it. This assumes the necessary ratios are possible by the internal dividers. However, in most cases <strong>SYSREF</strong> is used for deterministic latency.</p>
<figure>
<p><img alt="xilinx_pll_mux" src="../imgs/xilinx_pll_mux.png" />
  </p>
<figcaption><a href="https://docs.xilinx.com/v/u/en-US/ug576-ultrascale-gth-transceivers">From Xilinx UG576</a></figcaption>
</figure>
<h3 id="search-strategy">Search Strategy</h3>
<p>There are two main unique cases when selecting the <strong>ref clock</strong> and <strong>device clock</strong>:
* <em>N'</em> is not 8 or 16, or when <em>F</em> != 1, 2, or 4
* Otherwise</p>
<p>In case (1) the <strong>ref clock</strong> is unlikely to be derived from the <strong>device clock</strong>. Therefore, two separate clocks need to be provided to the FPGA. Otherwise, only a single clock (ignoring <strong>SYSREF</strong>) is required. This is the general behavior based on current analysis; however, this is not a hard definition. The internal solver is configured to favor <strong>ref clock</strong> and <strong>device clock</strong> to be the same value. When this is not possible it will automatically create a secondary clock from the clock chip to be specifically used a the <strong>device clock</strong>. The generation of a separate clock for device clock can be forced by setting <em>force_separate_device_clock</em> in the <em>fpga</em> object instantiated in the <em>system</em> object.</p>
<h2 id="api-controls">API Controls</h2>
<p>To manage the generation of these clocks, APIs are provided in the FPGA specific classes (<em>adijif.fpga.xilinx</em>). These are:</p>
<ul>
<li><strong>out_clk_select</strong>: Control {RX/TX}CLKSEL mux. Options are <em>XCVR_REFCLK</em>, <em>XCVR_REFCLK_DIV2</em>, <em>XCVR_PROGDIV_CLK</em></li>
<li><strong>force_cpll</strong>: Force use of CPLL</li>
<li><strong>force_qpll</strong>: Force use of QPLL</li>
<li><strong>force_qpll1</strong>: Force use of QPLL1 (only available on GTH and GTY transceivers)</li>
<li><strong>force_separate_device_clock</strong>: Enable generation of separate <strong>device clock</strong>. This rate is automatically determined base on Fmax of FPGA when enabled. When False the solver will automatically determine if a separate device clock is needed.</li>
</ul>
<p>By default <strong>adijif</strong> will try to determine valid PLL settings and necessary muxing settings to meet the <strong>link clock</strong> and <strong>ref clock</strong> requirements. If a separate <strong>device clock</strong> is needed enable <strong>requires_separate_link_layer_out_clock</strong>.</p>
<p>Below is an example of an explicit request for a separate <strong>device clock</strong> and since <strong>out_clk_select</strong> is set to <em>XCVR_REFCLK</em> it will force the <strong>ref clock</strong> to be equal to the <strong>link clock</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">adijif</span>

<span class="n">vcxo</span> <span class="o">=</span> <span class="mf">125e6</span>

<span class="n">sys</span> <span class="o">=</span> <span class="n">adijif</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;ad9680&quot;</span><span class="p">,</span> <span class="s2">&quot;ad9523_1&quot;</span><span class="p">,</span> <span class="s2">&quot;xilinx&quot;</span><span class="p">,</span> <span class="n">vcxo</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">Debug_Solver</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">setup_by_dev_kit_name</span><span class="p">(</span><span class="s2">&quot;zcu102&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">force_cpll</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">out_clk_select</span> <span class="o">=</span> <span class="s2">&quot;XCVR_REFCLK&quot;</span>  <span class="c1"># force reference to be core clock rate</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">requires_separate_link_layer_out_clock</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Get extra clock</span>

<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">use_direct_clocking</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">set_quick_configuration_mode</span><span class="p">(</span><span class="mh">0x88</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">S</span> <span class="o">==</span> <span class="mi">1</span>

<span class="c1"># Limit upper dividers to powers of 2</span>
<span class="n">sys</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>

<span class="c1"># Current configuration</span>
<span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">sample_clock</span> <span class="o">=</span> <span class="mf">1e9</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</code></pre></div>
<p>In the output the lines specific to the link layer and mux configuration have been highlighted:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">{</span><span class="s1">&#39;clock&#39;</span>: <span class="o">{</span><span class="s1">&#39;m1&#39;</span>: <span class="m">3</span>,
           <span class="s1">&#39;n2&#39;</span>: <span class="m">24</span>,
           <span class="s1">&#39;out_dividers&#39;</span>: <span class="o">[</span><span class="m">2</span>, <span class="m">64</span>, <span class="m">8</span>, <span class="m">4</span><span class="o">]</span>,
<span class="hll">           <span class="s1">&#39;output_clocks&#39;</span>: <span class="o">{</span><span class="s1">&#39;AD9680_fpga_link_out_clk&#39;</span>: <span class="o">{</span><span class="s1">&#39;divider&#39;</span>: <span class="m">4</span>,
</span><span class="hll">                                                          <span class="s1">&#39;rate&#39;</span>: <span class="m">250000000</span>.0<span class="o">}</span>,
</span>                             <span class="s1">&#39;ADC_CLK&#39;</span>: <span class="o">{</span><span class="s1">&#39;divider&#39;</span>: <span class="m">2</span>, <span class="s1">&#39;rate&#39;</span>: <span class="m">500000000</span>.0<span class="o">}</span>,
                             <span class="s1">&#39;ADC_CLK_FMC&#39;</span>: <span class="o">{</span><span class="s1">&#39;divider&#39;</span>: <span class="m">8</span>, <span class="s1">&#39;rate&#39;</span>: <span class="m">125000000</span>.0<span class="o">}</span>,
                             <span class="s1">&#39;ADC_SYSREF&#39;</span>: <span class="o">{</span><span class="s1">&#39;divider&#39;</span>: <span class="m">64</span>, <span class="s1">&#39;rate&#39;</span>: <span class="m">15625000</span>.0<span class="o">}</span>,
                             <span class="s1">&#39;CLKD_ADC_SYSREF&#39;</span>: <span class="o">{</span><span class="s1">&#39;divider&#39;</span>: <span class="m">64</span>,
                                                 <span class="s1">&#39;rate&#39;</span>: <span class="m">15625000</span>.0<span class="o">}}</span>,
           <span class="s1">&#39;part&#39;</span>: <span class="s1">&#39;AD9523-1&#39;</span>,
           <span class="s1">&#39;r2&#39;</span>: <span class="m">1</span>,
           <span class="s1">&#39;vco&#39;</span>: <span class="m">1000000000</span>.0,
           <span class="s1">&#39;vcxo&#39;</span>: <span class="m">125000000</span>.0<span class="o">}</span>,
 <span class="s1">&#39;converter&#39;</span>: <span class="o">[]</span>,
 <span class="s1">&#39;converter_AD9680&#39;</span>: <span class="o">{</span><span class="s1">&#39;clocking_option&#39;</span>: <span class="s1">&#39;direct&#39;</span>, <span class="s1">&#39;decimation&#39;</span>: <span class="m">1</span><span class="o">}</span>,
 <span class="s1">&#39;fpga_AD9680&#39;</span>: <span class="o">{</span><span class="s1">&#39;d&#39;</span>: <span class="m">1</span>,
                 <span class="s1">&#39;m&#39;</span>: <span class="m">1</span>,
                 <span class="s1">&#39;n1&#39;</span>: <span class="m">4</span>,
                 <span class="s1">&#39;n2&#39;</span>: <span class="m">5</span>,
<span class="hll">                 <span class="s1">&#39;out_clk_select&#39;</span>: <span class="s1">&#39;XCVR_REF_CLK&#39;</span>,
</span><span class="hll">                 <span class="s1">&#39;sys_clk_select&#39;</span>: <span class="s1">&#39;XCVR_QPLL1&#39;</span>,
</span><span class="hll">                 <span class="s1">&#39;transport_samples_per_clock&#39;</span>: <span class="m">2</span>,
</span><span class="hll">                 <span class="s1">&#39;type&#39;</span>: <span class="s1">&#39;cpll&#39;</span>,
</span>                 <span class="s1">&#39;vco&#39;</span>: <span class="m">2500000000</span>.0<span class="o">}</span>,
 <span class="s1">&#39;jesd_AD9680&#39;</span>: <span class="o">{</span><span class="s1">&#39;CS&#39;</span>: <span class="m">0</span>,
                 <span class="s1">&#39;F&#39;</span>: <span class="m">1</span>,
                 <span class="s1">&#39;HD&#39;</span>: <span class="m">1</span>,
                 <span class="s1">&#39;K&#39;</span>: <span class="m">32</span>,
                 <span class="s1">&#39;L&#39;</span>: <span class="m">4</span>,
                 <span class="s1">&#39;M&#39;</span>: <span class="m">2</span>,
                 <span class="s1">&#39;Np&#39;</span>: <span class="m">16</span>,
                 <span class="s1">&#39;S&#39;</span>: <span class="m">1</span>,
                 <span class="s1">&#39;bit_clock&#39;</span>: <span class="m">5000000000</span>.0,
                 <span class="s1">&#39;converter_clock&#39;</span>: <span class="m">500000000</span>.0,
                 <span class="s1">&#39;jesd_class&#39;</span>: <span class="s1">&#39;jesd204b&#39;</span>,
                 <span class="s1">&#39;jesd_mode&#39;</span>: <span class="s1">&#39;136&#39;</span>,
                 <span class="s1">&#39;multiframe_clock&#39;</span>: <span class="m">15625000</span>.0,
                 <span class="s1">&#39;sample_clock&#39;</span>: <span class="m">500000000</span>.0<span class="o">}}</span>
</code></pre></div></td></tr></table></div>
<h3 id="per-part-configuration">Per Part Configuration</h3>
<p>By default individual FPGA properties will be applies to all signal chains. However, if a specific only wants to be applied to the ADC or DAC side, or ADC1 but not ADC2, this configuration is possible. This is done through dictionary parameterization as following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">sys</span> <span class="o">=</span> <span class="n">adijif</span><span class="o">.</span><span class="n">system</span><span class="p">([</span><span class="s2">&quot;ad9680&quot;</span><span class="p">,</span> <span class="s2">&quot;ad9144&quot;</span><span class="p">],</span> <span class="s2">&quot;ad9523_1&quot;</span><span class="p">,</span> <span class="s2">&quot;xilinx&quot;</span><span class="p">,</span> <span class="mf">125e6</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">setup_by_dev_kit_name</span><span class="p">(</span><span class="s2">&quot;zcu102&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">force_cpll</span> <span class="o">=</span> <span class="kc">True</span>

<span class="hll"><span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">out_clk_select</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">    <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s2">&quot;XCVR_REFCLK&quot;</span><span class="p">,</span>
</span><span class="hll">    <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;XCVR_REFCLK_DIV2&quot;</span><span class="p">,</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="hll"><span class="n">sys</span><span class="o">.</span><span class="n">fpga</span><span class="o">.</span><span class="n">requires_separate_link_layer_out_clock</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">    <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="kc">True</span><span class="p">,</span>
</span><span class="hll">    <span class="n">sys</span><span class="o">.</span><span class="n">converter</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kc">False</span><span class="p">,</span>
</span><span class="hll"><span class="p">}</span>
</span><span class="o">...</span>
</code></pre></div></td></tr></table></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../fpgas/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Configuration Class" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Configuration Class
            </div>
          </div>
        </a>
      
      
        
        <a href="../parts/" class="md-footer__link md-footer__link--next" aria-label="Next: Supported Parts" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Supported Parts
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.5e67fbfe.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.e87a5f81.min.js"></script>
      
        <script src="../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://fastapi.tiangolo.com/js/termynal.js"></script>
      
        <script src="https://fastapi.tiangolo.com/js/custom.js"></script>
      
    
  </body>
</html>